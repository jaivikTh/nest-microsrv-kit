# ğŸ”„ Application Flow Diagram

## ğŸ“‹ Overview

This document provides detailed diagrams showing how the NestJS microservices application works, including authentication flows, request routing, and inter-service communication.

## ğŸ¯ Complete Application Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                   CLIENT                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   Web App   â”‚  â”‚ Mobile App  â”‚  â”‚   Postman   â”‚  â”‚   cURL      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼ HTTP/HTTPS Requests
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              API GATEWAY (Port 3000)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        SECURITY LAYER                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚Rate Limitingâ”‚  â”‚CORS Handler â”‚  â”‚Input Sanit. â”‚  â”‚Exception    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚Guard        â”‚  â”‚             â”‚  â”‚Pipe         â”‚  â”‚Filter       â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     AUTHENTICATION LAYER                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
â”‚  â”‚  â”‚JWT Strategy â”‚  â”‚JWT Auth     â”‚  â”‚@Public      â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  â”‚Guard        â”‚  â”‚Decorator    â”‚                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        CONTROLLERS                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚Auth         â”‚  â”‚User         â”‚  â”‚Order        â”‚  â”‚Health       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚Controller   â”‚  â”‚Controller   â”‚  â”‚Controller   â”‚  â”‚Controller   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚(Public)     â”‚  â”‚(Protected)  â”‚  â”‚(Protected)  â”‚  â”‚(Public)     â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼ TCP Communication
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              MICROSERVICES LAYER                               â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚     USER SERVICE            â”‚           â”‚     ORDER SERVICE           â”‚     â”‚
â”‚  â”‚      (Port 3001)            â”‚           â”‚      (Port 3002)            â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚     â”‚
â”‚  â”‚  â”‚ TCP Message         â”‚    â”‚           â”‚  â”‚ TCP Message         â”‚    â”‚     â”‚
â”‚  â”‚  â”‚ Patterns:           â”‚    â”‚           â”‚  â”‚ Patterns:           â”‚    â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ get_users         â”‚    â”‚           â”‚  â”‚ â€¢ get_orders        â”‚    â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ get_user_by_id    â”‚    â”‚           â”‚  â”‚ â€¢ get_order_by_id   â”‚    â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ create_user       â”‚    â”‚           â”‚  â”‚ â€¢ create_order      â”‚    â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ update_user       â”‚    â”‚           â”‚  â”‚ â€¢ update_order      â”‚    â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ delete_user       â”‚    â”‚           â”‚  â”‚ â€¢ delete_order      â”‚    â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚     â”‚
â”‚  â”‚  â”‚ Business Logic      â”‚    â”‚           â”‚  â”‚ Business Logic      â”‚    â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ User validation   â”‚    â”‚           â”‚  â”‚ â€¢ Order validation  â”‚    â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Data processing   â”‚    â”‚           â”‚  â”‚ â€¢ Data processing   â”‚    â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Error handling    â”‚    â”‚           â”‚  â”‚ â€¢ Error handling    â”‚    â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼ Database Queries
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DATA LAYER                                        â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚      POSTGRESQL             â”‚           â”‚        REDIS                â”‚     â”‚
â”‚  â”‚      (Port 5433)            â”‚           â”‚      (Port 6380)            â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚     â”‚
â”‚  â”‚  â”‚ Tables:             â”‚    â”‚           â”‚  â”‚ Cache Storage:      â”‚    â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ users             â”‚    â”‚           â”‚  â”‚ â€¢ Session data      â”‚    â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ orders            â”‚    â”‚           â”‚  â”‚ â€¢ JWT tokens        â”‚    â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ relationships     â”‚    â”‚           â”‚  â”‚ â€¢ Rate limit data   â”‚    â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚           â”‚  â”‚ â€¢ Temporary data    â”‚    â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚     â”‚
â”‚  â”‚  â”‚ Features:           â”‚    â”‚           â”‚                             â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ ACID compliance   â”‚    â”‚           â”‚                             â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Transactions      â”‚    â”‚           â”‚                             â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Constraints       â”‚    â”‚           â”‚                             â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Indexes           â”‚    â”‚           â”‚                             â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚           â”‚                             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Authentication Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLIENT    â”‚                    â”‚ API GATEWAY â”‚                    â”‚  DATABASE   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                  â”‚                                  â”‚
       â”‚ 1. POST /auth/register           â”‚                                  â”‚
       â”‚ {name, email, password}          â”‚                                  â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                                  â”‚
       â”‚                                  â”‚ 2. Validate input               â”‚
       â”‚                                  â”‚    (DTO validation)              â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 3. Hash password                 â”‚
       â”‚                                  â”‚    (bcrypt, 12 rounds)           â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 4. Check email exists            â”‚
       â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 5. Create user record            â”‚
       â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 6. User created                  â”‚
       â”‚                                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 7. Generate JWT token            â”‚
       â”‚                                  â”‚    {sub, email, name, exp}       â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚ 8. Return token & user data      â”‚                                  â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  â”‚
       â”‚ {access_token, user, expires_in} â”‚                                  â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚ 9. POST /auth/login              â”‚                                  â”‚
       â”‚ {email, password}                â”‚                                  â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                                  â”‚
       â”‚                                  â”‚ 10. Find user by email           â”‚
       â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 11. User data                    â”‚
       â”‚                                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 12. Compare passwords            â”‚
       â”‚                                  â”‚     (bcrypt.compare)             â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 13. Generate JWT token           â”‚
       â”‚                                  â”‚     {sub, email, name, exp}      â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚ 14. Return token & user data     â”‚                                  â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  â”‚
       â”‚ {access_token, user, expires_in} â”‚                                  â”‚
```

## ğŸ›¡ï¸ Protected Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLIENT    â”‚                    â”‚ API GATEWAY â”‚                    â”‚MICROSERVICE â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                  â”‚                                  â”‚
       â”‚ 1. GET /users                    â”‚                                  â”‚
       â”‚ Authorization: Bearer <token>    â”‚                                  â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                                  â”‚
       â”‚                                  â”‚ 2. Rate Limiting Check           â”‚
       â”‚                                  â”‚    (3 req/sec, 100 req/min)     â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 3. Input Sanitization            â”‚
       â”‚                                  â”‚    (XSS, SQL injection)          â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 4. JWT Auth Guard                â”‚
       â”‚                                  â”‚    â€¢ Extract Bearer token        â”‚
       â”‚                                  â”‚    â€¢ Verify signature            â”‚
       â”‚                                  â”‚    â€¢ Check expiration            â”‚
       â”‚                                  â”‚    â€¢ Decode payload              â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 5. @CurrentUser decorator        â”‚
       â”‚                                  â”‚    â€¢ Inject user into request    â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 6. Route to controller           â”‚
       â”‚                                  â”‚    UserController.getUsers()     â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 7. TCP message to service        â”‚
       â”‚                                  â”‚    pattern: 'get_users'          â”‚
       â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 8. Process request               â”‚
       â”‚                                  â”‚                                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                  â”‚                                  â”‚ â”‚  DATABASE   â”‚
       â”‚                                  â”‚                                  â”œâ–ºâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 9. Return users data             â”‚
       â”‚                                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 10. Security Interceptor         â”‚
       â”‚                                  â”‚     â€¢ Add security headers       â”‚
       â”‚                                  â”‚     â€¢ Sanitize response          â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚ 11. Return response              â”‚                                  â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  â”‚
       â”‚ {users: [...], status: 200}     â”‚                                  â”‚
```

## ğŸ”„ Order Creation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLIENT    â”‚    â”‚ API GATEWAY â”‚    â”‚ORDER SERVICEâ”‚    â”‚USER SERVICE â”‚    â”‚  DATABASE   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚                  â”‚                  â”‚
       â”‚ 1. POST /orders  â”‚                  â”‚                  â”‚                  â”‚
       â”‚ + JWT token      â”‚                  â”‚                  â”‚                  â”‚
       â”‚ {product, amount}â”‚                  â”‚                  â”‚                  â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚ 2. Authenticate  â”‚                  â”‚                  â”‚
       â”‚                  â”‚    & authorize   â”‚                  â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚ 3. Validate DTO  â”‚                  â”‚                  â”‚
       â”‚                  â”‚    (product,     â”‚                  â”‚                  â”‚
       â”‚                  â”‚     amount)      â”‚                  â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚ 4. TCP: create_order               â”‚                  â”‚
       â”‚                  â”‚    {userId, product, amount}       â”‚                  â”‚
       â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚                  â”‚
       â”‚                  â”‚                  â”‚ 5. Validate user â”‚                  â”‚
       â”‚                  â”‚                  â”‚    exists        â”‚                  â”‚
       â”‚                  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚ 6. Check user    â”‚
       â”‚                  â”‚                  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                  â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚ 7. User exists   â”‚
       â”‚                  â”‚                  â”‚                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                  â”‚                  â”‚ 8. User valid    â”‚                  â”‚
       â”‚                  â”‚                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚                  â”‚ 9. Create order  â”‚                  â”‚
       â”‚                  â”‚                  â”‚    record        â”‚                  â”‚
       â”‚                  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                  â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚                  â”‚ 10. Order createdâ”‚                  â”‚
       â”‚                  â”‚                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                  â”‚                  â”‚                  â”‚                  â”‚
       â”‚                  â”‚ 11. Return order â”‚                  â”‚                  â”‚
       â”‚                  â”‚     data         â”‚                  â”‚                  â”‚
       â”‚                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚                  â”‚
       â”‚                  â”‚                  â”‚                  â”‚                  â”‚
       â”‚ 12. Order createdâ”‚                  â”‚                  â”‚                  â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚                  â”‚                  â”‚
       â”‚ {id, product,    â”‚                  â”‚                  â”‚                  â”‚
       â”‚  amount, userId, â”‚                  â”‚                  â”‚                  â”‚
       â”‚  createdAt}      â”‚                  â”‚                  â”‚                  â”‚
```

## ğŸš¨ Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLIENT    â”‚                    â”‚ API GATEWAY â”‚                    â”‚MICROSERVICE â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                  â”‚                                  â”‚
       â”‚ 1. Invalid request               â”‚                                  â”‚
       â”‚ (missing token, bad data)        â”‚                                  â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                                  â”‚
       â”‚                                  â”‚ 2. Validation fails              â”‚
       â”‚                                  â”‚    â€¢ DTO validation              â”‚
       â”‚                                  â”‚    â€¢ JWT validation              â”‚
       â”‚                                  â”‚    â€¢ Rate limit exceeded         â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 3. AllExceptionFilter            â”‚
       â”‚                                  â”‚    â€¢ Catch all exceptions        â”‚
       â”‚                                  â”‚    â€¢ Format error response       â”‚
       â”‚                                  â”‚    â€¢ Log error details           â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 4. Security headers              â”‚
       â”‚                                  â”‚    â€¢ Remove sensitive data       â”‚
       â”‚                                  â”‚    â€¢ Add security headers        â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚ 5. Standardized error response   â”‚                                  â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  â”‚
       â”‚ {                                â”‚                                  â”‚
       â”‚   statusCode: 400,               â”‚                                  â”‚
       â”‚   message: "Validation failed",  â”‚                                  â”‚
       â”‚   error: "Bad Request",          â”‚                                  â”‚
       â”‚   timestamp: "2025-07-21..."     â”‚                                  â”‚
       â”‚ }                                â”‚                                  â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 6. Service error                 â”‚
       â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 7. Database error                â”‚
       â”‚                                  â”‚    â€¢ Connection failed           â”‚
       â”‚                                  â”‚    â€¢ Query error                 â”‚
       â”‚                                  â”‚    â€¢ Constraint violation        â”‚
       â”‚                                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                  â”‚                                  â”‚
       â”‚                                  â”‚ 8. Transform to HTTP error       â”‚
       â”‚                                  â”‚    â€¢ Map to appropriate status   â”‚
       â”‚                                  â”‚    â€¢ Sanitize error message      â”‚
       â”‚                                  â”‚                                  â”‚
       â”‚ 9. Error response                â”‚                                  â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  â”‚
       â”‚ {                                â”‚                                  â”‚
       â”‚   statusCode: 500,               â”‚                                  â”‚
       â”‚   message: "Internal server...", â”‚                                  â”‚
       â”‚   error: "Internal Server Error" â”‚                                  â”‚
       â”‚ }                                â”‚                                  â”‚
```

## ğŸ”„ Data Flow Summary

### 1. **Request Processing Pipeline**
```
Client Request â†’ Rate Limiting â†’ CORS â†’ Input Sanitization â†’ JWT Auth â†’ Controller â†’ Service â†’ Database
```

### 2. **Response Processing Pipeline**
```
Database â†’ Service â†’ Controller â†’ Security Interceptor â†’ Exception Filter â†’ Client Response
```

### 3. **Authentication Pipeline**
```
Bearer Token â†’ JWT Strategy â†’ Token Validation â†’ User Extraction â†’ Request Context
```

### 4. **Inter-Service Communication**
```
API Gateway â†’ TCP Message â†’ Microservice â†’ Database Query â†’ Response â†’ TCP Response â†’ HTTP Response
```

## ğŸ› ï¸ Key Components Interaction

### **Security Layer Components**
- **Rate Limiting Guard**: Prevents abuse (3 req/sec, 100 req/min)
- **CORS Handler**: Manages cross-origin requests
- **Input Sanitization**: Prevents XSS and injection attacks
- **JWT Auth Guard**: Validates authentication tokens
- **Exception Filter**: Standardizes error responses

### **Authentication Components**
- **JWT Strategy**: Passport.js strategy for token validation
- **Auth Service**: Handles login, registration, token generation
- **Password Util**: Bcrypt hashing and validation
- **User Decorators**: @CurrentUser, @Public for easy access

### **Communication Components**
- **TCP Transport**: Inter-service communication
- **Message Patterns**: Structured service calls
- **DTO Validation**: Input/output data validation
- **Error Propagation**: Consistent error handling across services

### **Data Components**
- **Sequelize ORM**: Database abstraction layer
- **Entity Models**: User and Order data models
- **Database Module**: Centralized database configuration
- **Redis Cache**: Session and temporary data storage

## ğŸ“Š Performance Considerations

### **Request Flow Optimization**
1. **Rate limiting** prevents system overload
2. **JWT validation** is stateless and fast
3. **TCP communication** is efficient for inter-service calls
4. **Database indexing** on user emails and order IDs
5. **Redis caching** for frequently accessed data

### **Security Measures**
1. **Input sanitization** prevents malicious data
2. **JWT tokens** expire after 24 hours
3. **Password hashing** uses 12 salt rounds
4. **HTTPS enforcement** in production
5. **Security headers** added to all responses

---

**Diagram Version:** 1.0.0  
**Last Updated:** 2025-07-21  
**Architecture:** NestJS Microservices with JWT Authentication